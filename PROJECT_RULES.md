# 电商平台后端项目开发规范

## 1. 项目概述

本项目是电商平台的后端服务系统，采用 Spring Boot 框架开发，提供 RESTful API 接口服务。

### 1.1 项目信息
- **项目名称**: qytbackend
- **技术栈**: Spring Boot 4.0.1 + MyBatis + MySQL + Java 21
- **打包方式**: WAR
- **构建工具**: Maven

## 2. 技术栈规范

### 2.1 核心技术
- **框架**: Spring Boot 4.0.1
- **ORM**: MyBatis 4.0.1
- **数据库**: MySQL 8.0+
- **Java版本**: Java 21
- **工具库**: Lombok

### 2.2 依赖管理
- 使用 Maven 进行依赖管理
- 禁止引入未经验证的第三方依赖
- 定期更新依赖版本，修复安全漏洞

## 3. 项目结构规范

### 3.1 标准目录结构
```
src/main/java/com/qyt/qytbackend/
├── controller/          # 控制器层，处理HTTP请求
├── service/             # 业务逻辑层
│   ├── impl/           # 服务实现类
├── rpc/                 # RPC层，调用外部接口
│   ├── impl/           # RPC实现类
│   ├── client/         # HTTP客户端等工具类
│   └── dto/            # RPC数据传输对象
├── mapper/              # MyBatis Mapper接口
├── entity/              # 实体类（对应数据库表）
├── dto/                 # 数据传输对象（Data Transfer Object）
├── vo/                  # 视图对象（View Object）
├── config/              # 配置类
├── util/                # 工具类
├── exception/           # 异常处理
│   ├── handler/        # 全局异常处理器
├── common/              # 公共类
│   ├── constant/       # 常量定义
│   ├── enums/          # 枚举类
│   └── result/         # 统一响应结果
└── security/            # 安全相关（JWT、权限等）
```

### 3.2 资源文件结构
```
src/main/resources/
├── mapper/              # MyBatis XML映射文件
├── static/              # 静态资源
└── application.properties  # 配置文件
```

## 4. 编码规范

### 4.1 命名规范
- **类名**: 使用大驼峰命名（PascalCase），如 `UserController`、`OrderService`
- **方法名**: 使用小驼峰命名（camelCase），如 `getUserById`、`createOrder`
- **变量名**: 使用小驼峰命名，如 `userId`、`orderList`
- **常量名**: 全大写，单词间用下划线分隔，如 `MAX_RETRY_COUNT`、`DEFAULT_PAGE_SIZE`
- **包名**: 全小写，单词间用点分隔，如 `com.qyt.qytbackend.controller`

### 4.2 代码风格
- 使用 4 个空格进行缩进（不使用 Tab）
- 每行代码长度不超过 120 个字符
- 类和方法必须添加 JavaDoc 注释
- 复杂业务逻辑必须添加行内注释
- 使用 Lombok 简化代码，但避免过度使用

### 4.3 类设计规范
- **Controller**: 只负责接收请求和返回响应，不包含业务逻辑
- **Service**: 包含业务逻辑，一个 Service 对应一个业务领域
- **RPC**: 负责调用外部接口（如微信支付、短信服务等），封装外部API调用细节
- **Mapper**: 只负责数据库操作，方法名要清晰表达操作意图
- **Entity**: 对应数据库表，使用 Lombok 的 `@Data` 注解
- **DTO**: 用于接收前端数据，使用 `@Valid` 进行参数校验
- **VO**: 用于返回给前端的数据，不包含敏感信息
- **RPC DTO**: 用于RPC层与外部接口交互的数据传输对象

## 5. 数据库规范

### 5.1 表设计规范
- 表名使用小写字母，单词间用下划线分隔，如 `user_info`、`order_detail`
- 每个表必须包含以下字段：
  - `id`: 主键，BIGINT，自增
  - `create_time`: 创建时间，DATETIME
  - `update_time`: 更新时间，DATETIME
  - `is_deleted`: 逻辑删除标记，TINYINT(1)，0-未删除，1-已删除
- 字段名使用小写字母，单词间用下划线分隔
- 必须为每个表添加注释说明

### 5.2 SQL 规范
- 禁止在代码中拼接 SQL，必须使用 MyBatis 的参数绑定
- 复杂查询使用 XML 映射文件，简单查询可使用注解
- 避免使用 `SELECT *`，明确指定需要的字段
- 合理使用索引，避免全表扫描
- 事务管理使用 `@Transactional` 注解

### 5.3 数据库操作规范
- 所有删除操作使用逻辑删除，不进行物理删除
- 批量操作必须考虑性能，避免 N+1 查询问题
- 敏感数据必须加密存储（如密码、支付信息）

## 6. API 设计规范

### 6.1 RESTful API 规范
- 使用 RESTful 风格设计 API
- URL 使用小写字母，单词间用连字符分隔，如 `/api/users/{id}`
- HTTP 方法使用规范：
  - `GET`: 查询操作
  - `POST`: 创建操作
  - `PUT`: 完整更新操作
  - `PATCH`: 部分更新操作
  - `DELETE`: 删除操作

### 6.2 API 路径规范
```
/api/v1/                    # API版本前缀
├── /users                  # 用户相关
├── /products               # 商品相关
├── /orders                 # 订单相关
├── /cart                   # 购物车相关
├── /payments               # 支付相关
└── /admin                  # 管理后台相关
```

### 6.3 统一响应格式
所有 API 响应必须使用统一的格式：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2024-01-01T12:00:00"
}
```

### 6.4 状态码规范
- `200`: 请求成功
- `201`: 创建成功
- `400`: 请求参数错误
- `401`: 未授权
- `403`: 无权限
- `404`: 资源不存在
- `500`: 服务器内部错误

### 6.5 分页规范
分页请求参数：
- `page`: 页码，从 1 开始
- `size`: 每页数量，默认 10，最大 100

分页响应格式：
```json
{
  "code": 200,
  "data": {
    "list": [],
    "total": 100,
    "page": 1,
    "size": 10,
    "pages": 10
  }
}
```

## 7. 安全规范

### 7.1 认证与授权
- 使用 JWT（JSON Web Token）进行用户认证
- Token 必须设置过期时间
- 敏感接口必须进行权限校验
- 密码必须加密存储（使用 BCrypt）

### 7.2 数据安全
- 所有用户输入必须进行校验和过滤
- 防止 SQL 注入（使用 MyBatis 参数绑定）
- 防止 XSS 攻击（对输出进行转义）
- 敏感信息不在日志中输出
- API 接口必须进行限流

### 7.3 接口安全
- 使用 HTTPS 传输
- 重要操作需要二次验证
- 记录操作日志，便于审计

## 8. 异常处理规范

### 8.1 异常分类
- **业务异常**: 使用自定义业务异常类，如 `BusinessException`
- **系统异常**: 使用系统异常类，如 `SystemException`
- **参数异常**: 使用参数校验异常，如 `ValidationException`

### 8.2 异常处理
- 使用全局异常处理器统一处理异常
- 异常信息要清晰，但不暴露系统内部细节
- 记录异常日志，便于排查问题

## 9. 日志规范

### 9.1 日志级别
- `ERROR`: 错误信息，需要立即处理
- `WARN`: 警告信息，需要关注
- `INFO`: 重要业务流程信息
- `DEBUG`: 调试信息，开发环境使用

### 9.2 日志格式
- 使用统一的日志格式
- 包含时间、级别、类名、方法名、消息
- 敏感信息不记录到日志

## 10. 测试规范

### 10.1 单元测试
- Service 层方法必须编写单元测试
- 测试覆盖率不低于 70%
- 使用 JUnit 5 和 Mockito 进行测试

### 10.2 集成测试
- 关键业务流程必须编写集成测试
- 使用 `@SpringBootTest` 进行集成测试

## 11. 版本控制规范

### 11.1 Git 提交规范
提交信息格式：`<type>(<scope>): <subject>`

- **type**: 提交类型
  - `feat`: 新功能
  - `fix`: 修复bug
  - `docs`: 文档更新
  - `style`: 代码格式调整
  - `refactor`: 代码重构
  - `test`: 测试相关
  - `chore`: 构建/工具相关

- **scope**: 影响范围（可选）
- **subject**: 简短描述

示例：
```
feat(user): 添加用户注册功能
fix(order): 修复订单金额计算错误
docs: 更新API文档
```

### 11.2 分支管理
- `main/master`: 主分支，生产环境代码
- `develop`: 开发分支
- `feature/*`: 功能分支
- `bugfix/*`: 修复分支
- `hotfix/*`: 紧急修复分支

## 12. 配置管理规范

### 12.1 配置文件
- 使用 `application.properties` 或 `application.yml`
- 不同环境使用不同的配置文件：
  - `application-dev.properties`: 开发环境
  - `application-test.properties`: 测试环境
  - `application-prod.properties`: 生产环境

### 12.2 敏感信息
- 敏感配置（如数据库密码、密钥）不提交到代码仓库
- 使用环境变量或配置中心管理敏感信息

## 13. 性能优化规范

### 13.1 数据库优化
- 合理使用索引
- 避免 N+1 查询问题
- 大数据量查询使用分页
- 合理使用缓存（Redis）

### 13.2 接口优化
- 接口响应时间控制在 200ms 以内
- 使用异步处理耗时操作
- 合理使用缓存减少数据库查询

## 14. 开发流程规范

### 14.1 开发前
1. 从 `develop` 分支创建功能分支
2. 明确需求和技术方案
3. 设计数据库表结构
4. 设计 API 接口

### 14.2 开发中
1. 遵循编码规范
2. 编写必要的注释和文档
3. 及时提交代码（每天至少提交一次）

### 14.3 开发后
1. 编写单元测试
2. 进行代码自测
3. 提交代码审查
4. 合并到 `develop` 分支

## 15. RPC层设计规范

### 15.1 RPC层职责
- **封装外部接口调用**: 统一管理所有外部服务调用（支付、短信、邮件等）
- **接口抽象**: 定义统一的RPC接口，便于切换不同的服务提供商
- **异常处理**: 统一处理外部接口调用异常，转换为业务异常
- **日志记录**: 记录所有外部接口调用日志，便于问题排查

### 15.2 RPC层结构
- **接口层**: 定义RPC接口，如 `WeChatPayRpc`、`SmsRpc`
- **实现层**: 实现具体的RPC接口，如 `WeChatPayRpcImpl`、`SmsRpcImpl`
- **客户端**: HTTP客户端等工具类，封装网络请求
- **DTO**: RPC专用的数据传输对象，如 `WeChatPayRequest`、`SmsRequest`

### 15.3 RPC层开发规范
- 所有外部接口调用必须通过RPC层
- RPC接口方法要有清晰的JavaDoc注释
- 实现类要处理异常并转换为业务异常
- 配置信息统一放在 `application.properties` 中
- 支持多服务商切换（如短信服务支持阿里云、腾讯云等）

## 16. 电商业务模块

### 16.1 核心模块
- **用户模块**: 注册、登录、个人信息管理
- **商品模块**: 商品列表、商品详情、商品搜索
- **购物车模块**: 添加、删除、修改购物车
- **订单模块**: 创建订单、订单查询、订单状态管理
- **支付模块**: 支付接口、支付回调、退款（通过RPC层调用）
- **评价模块**: 商品评价、评价查询

### 16.2 管理后台模块
- **商品管理**: 商品CRUD、库存管理
- **订单管理**: 订单查询、订单处理
- **用户管理**: 用户查询、用户状态管理
- **数据统计**: 销售统计、用户统计

## 17. 注意事项

1. **代码审查**: 所有代码必须经过审查才能合并
2. **文档更新**: 修改接口或功能后及时更新文档
3. **向后兼容**: 修改接口时考虑向后兼容性
4. **错误处理**: 所有可能的异常情况都要处理
5. **性能考虑**: 开发时就要考虑性能问题

## 18. 参考资源

- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)
- [MyBatis 官方文档](https://mybatis.org/mybatis-3/)
- [阿里巴巴 Java 开发手册](https://developer.aliyun.com/special/tech-java)

---

**最后更新**: 2024年
**维护者**: 开发团队
